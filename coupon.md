# 쿠폰 발급



준비 
로드밸런스 설정에서 여러 서버로 트래픽 분산을 준비합니다
- 쿠폰 발급을 처리 api 에 대해 전담 서버로 라우팅

또한 충분한 수의 인스턴스를 준비하여 오토 스케일링 그룹에 준비시킵니다
백엔드에서 rate limit을 설정하여 봇, 비정상 반복을 제한합니다
redis에 쿠폰 수량을 미리 저장합니다

핵심
백엔드에 요청이 들어오면 redis를 통해 쿠폰 개수를 차감합니다
이때 lua script를 사용하여 원자적 연산이 가능하도록 합니다
- 쿠폰 수 확인
- 쿠폰 수 차감
- 쿠폰 발급 목록에 사용자 추가
- 쿠폰 발급 결과 반환

redis르 결과를 통해 실패면 쿠폰 발급 실패라 반환합니다
쿠폰 발급 결과가 성공이면 쿠폰 생성 로직을 동기적으로 실행하거나 메시지를 발행하여 비동기적으로 후속 작업을 처리하도록 합니다